---
title: "Loading and description of the files"
author: "Lou-Ann and Ambrosia"
format: html
editor: visual
repo-url: https://github.com/Ambrosia-P/FinalProjectR
execute:
  echo: false
  message: false
  warning: false
---

# Raw Data

Raw data files are stored in the [`/data`](https://github.com/Ambrosia-P/FinalProjectR/tree/master/data) folder:

**Energy Prices**: `EnergyPricesNewVersion.csv` - Electricity and gas prices for European countries

**Gas Prices**: `Dutch TTF Natural Gas Futures Historical Data.csv` - TTF (Title Transfer Facility) natural gas prices

**Energy Prices**: `EnergyPricesNewVersion.xlsx` - Electricity and gas prices for European countries

**Gas Prices**: `TTF_Prices.xlsx` - TTF (Title Transfer Facility) natural gas prices


**Pipeline Importations** : `Imports_pipeline.csv` - Importations from Russia by pipeline

**Liquified Natural gas importations** : `LNG_2019.csv` - Annual importations of natural gas from Russia by boat (also provided for 2020, 2021, 2022, 2023 and 2024). All years from 2019 to 2024 are combined the the data frame `LNG_imports`

**Electricity production by sources** : `Combustible_fuels.csv` - Electricity produced by combustible fuels (also provided for Fossil fuels, Hydro, Natural gas, Nuclear, Renewable sources, Solar, Wind and Total)

# Cleaned Data

Processed data files are in the [`/cleaned_data`](https://github.com/Ambrosia-P/FinalProjectR/tree/master/cleaned_data) folder:

**Electricity Prices**: `Energypricescleaned.csv` - cleaned household electricity prices for nine European countries (France, Germany, Spain, Italy, Netherlands, Poland, Bulgaria, Sweden, and Finland) from 2019 to 2024, bi-annual data, prices excluding taxes and levies

**Gas Prices**: `Gaspricescleaned.csv` - cleaned Dutch TTF natural gas prices with monthly closing prices in euros per megawatt-hour for the same time period

**Importations from Russia** : `Total_imports.csv` - cleaned importations of natural gas from Russia, from both pipeline and boat, from 2019 to 2024 for the nine selected European countries, in million of cubic meters, monthly data.

**Electricity Production by sources** : `all_sources.csv` - cleaned decomposition of electricity production by source from 2019 to 2024 for the nine selected countries, with the total of electricity produced in the country, monthly data. We can derive a data frame for each country by using : sources_list and sources_list\$Country


# Sources description

This project relies on two primary data sources that provide comprehensive and reliable information on European energy markets during the 2019-2024 period, encompassing both the pre-crisis baseline and the tumultuous energy crisis that followed Russia's invasion of Ukraine in February 2022.

### Eurostat - Energy Database (https://ec.europa.eu/eurostat/data/database)

Eurostat serves as the statistical office of the European Union, responsible for collecting, harmonizing, and publishing official statistics across all EU member states. Our primary datasets on electricity prices, electricity generation by source, and natural gas importations were obtained from Eurostat's comprehensive energy database. This source is particularly valuable for academic research due to its rigorous data collection methodology, which follows standardized protocols established under EU Regulation 1099/2008 on energy statistics.
National statistical institutes from each member country report data to Eurostat following uniform definitions and classifications, ensuring cross-country comparability—a critical requirement for our comparative analysis of how different European countries responded to the energy crisis. The electricity price data specifically covers household consumers in the medium consumption band (2,500-5,000 kWh annually), excluding taxes and levies to enable pure market price comparisons. Electricity generation data is disaggregated by fuel type (combustible fuels, hydro, solar, wind, nuclear, natural gas, renewables/biofuels), allowing us to analyze each country's energy mix and its relationship to price volatility. The gas importation statistics distinguish between pipeline imports and LNG (Liquified Natural Gas) imports, providing granular insight into the dramatic shifts in European energy supply chains following reduced Russian deliveries.
All Eurostat data is freely accessible and downloadable in CSV format, with full documentation of collection methodologies, definitions, and any breaks in series. The temporal coverage spans January 2019 to December 2024 for monthly data (gas imports, electricity generation) and semester 1 of 2019 to semester 2 of 2024 for bi-annual data (electricity prices), providing a robust six-year window that captures both normal market conditions and crisis dynamics.

### Investing.com - TTF Natural Gas Futures (https://www.investing.com/commodities/dutch-ttf-gas-c1-futures-historical-data)

To complement Eurostat's official statistics, we obtained daily natural gas price data from Investing.com, a leading financial markets platform that aggregates trading data from global exchanges. Specifically, we collected historical prices for TTF (Title Transfer Facility) Dutch natural gas futures—the primary benchmark for European wholesale gas prices traded on the Intercontinental Exchange (ICE).
The TTF hub, located in the Netherlands, became Europe's most liquid natural gas trading point and the de facto reference price for European gas contracts following the UK's exit from the EU. Daily closing prices are expressed in euros per megawatt-hour (€/MWh), the standard unit for energy commodity pricing in Europe. This high-frequency data (daily observations from January 2019 through December 2024) was aggregated into monthly and semester averages for our analysis, enabling direct comparison with the electricity price data.
Using market-based pricing data from Investing.com rather than reported average prices provides several advantages: it captures real-time market sentiment and expectations, reflects the actual prices at which large volumes of gas traded, and includes the extreme volatility that characterized the 2022 crisis when spot prices briefly exceeded €300/MWh. The combination of official government statistics (Eurostat) and market trading data (Investing.com) provides a comprehensive view of both physical energy flows and price formation mechanisms during this unprecedented period in European energy markets.

# Description of the data collection

This data selection examines electricity and natural gas prices during the 2022 European Energy Crisis using data from two authoritative sources covering nine European countries (France, Germany, Spain, Italy, Netherlands, Poland, Bulgaria, Sweden, and Finland) from 2019 to 2024.

**Electricity Prices for Household Consumers** (Code: nrg_pc_204): This dataset is sourced from Eurostat and accessible via the [Eurostat Data Browser](https://ec.europa.eu/eurostat/databrowser/bookmark/3fc4f5aa-4d49-4ab4-9b16-392cc50555ed?lang=en&createdAt=2025-11-10T18:38:30Z). The dataframe measures electricity prices in euros for all 27 countries of the European Union from 2007 to 2025, with data collected bi-annually. For our purposes, we selected data for our nine chosen countries covering the period from 2019 to 2024, using prices that exclude taxes and levies.

**Dutch TTF Natural Gas Prices**: This dataset is sourced from [Investing.com](https://www.investing.com/commodities/dutch-ttf-gas-c1-futures-historical-data) and provides monthly closing prices in euros per megawatt-hour. The Dutch TTF (Title Transfer Facility) gas market serves as the main benchmark for natural gas trading in Europe, setting the wholesale prices used in most European contracts. This makes it an essential indicator for understanding gas price movements across the continent during the crisis period.

**Pipeline Importations** (Code: nrg_ti_gasm) : This data set is sourced from Eurostat and accesible via the [Eurostat Data Browser](https://ec.europa.eu/eurostat/databrowser/view/nrg_ti_gasm/default/table?lang=fr). The initial data set measures the amount of natural gas in million of cubic meter that is imported by all 27 countries from global partners, from 2008 to 2025, with data collected monthly . We selected Russia as a partner and our nine countries as geopolitical entities to keep only the dependency on Russian importations over our time period (2019-2024)

**Liquified Natural Gas Importations** : When looking at the pipeline importations, we realized that the Eurostat data frame indicated that some countries didn't import any Russian gas during our time period. If it can be coherent for countries such as Denmark (which mainly on renewable sources), it is absolutely not true for countries such as Germany that are highly dependent on Russian importations. The fact remains that these countries do not imports Russian gas by pipeline, but by boat in a liquefied form. Therefore, to have a more precise analysis, we have decided to add the LNG (Liquefied Natural Gas) importations. This data set is sourced from the WITS, World Integrated Trade Solution (a database developed by the World Bank in collaboration with others organizations) and accessible via [WITS.com](https://wits.worldbank.org/trade/comtrade/en/country/All/year/2023/tradeflow/Imports/partner/RUS/product/271111?utm_source=chatgpt.com). This data set measures the amount of LNG in kilograms imported by countries all around the world from different partners, from 1992 to 2024, with data collected annually. We decided to select our nine countries (if they do import LNG) as reporters and the Russian Federation as partner.

**Electricity production by source** (Code: nrg_cb_pem): This data frame is sourced from Eurostat and accessible via the [Eurostat Data Browser](https://ec.europa.eu/eurostat/databrowser/bookmark/3fa70279-4410-4fb9-a55b-5a4038eea201?lang=en&createdAt=2025-11-10T19:11:35Z). The original data set provides the net generation of electricity by source / type of fuels in gigawatts per hour, from 2008 to 2025, for all 27 european countries, with data collected monthly. For our nine countries, we decided to select only the most relevant and known sources out of the 23 types of fuels provided and decided to keep the total of energy generated in order to compute the energy mix later.

# Data summary

### Electricity prices

```{r}

library(knitr)
library(readr)



electricity_data <- read_csv2("cleaned_data/Energypricescleaned.csv")


electricity_info <- data.frame(
  Attribute = c("Dataset", "Number of Rows", "Number of Columns", "Column Names"),
  Value = c(
    "Energypricescleaned.csv",
    nrow(electricity_data),
    ncol(electricity_data),
    paste(colnames(electricity_data), collapse = ", ")
  )
)

kable(electricity_info, 
      caption = "Basic Information: Cleaned Electricity Prices Dataset",
      col.names = c("Attribute", "Value"))
```

### Gas prices

```{r}
library(readr)
library(knitr)

gas_data <- read_csv2("cleaned_data/Gaspricescleaned.csv")

gas_info <- data.frame( Attribute = c("Dataset", "Number of Rows", "Number of Columns", "Column Names"),Value = c("Gaspricescleaned.csv",
    nrow(gas_data),
    ncol(gas_data),
    paste(colnames(gas_data), collapse = ", ")))

kable(gas_info, 
      caption = "Basic Information: Cleaned Gas Prices Dataset",
      col.names = c("Attribute", "Value"))
```

## Gas Importations

```{r}

library(readr)

Importations <- read_csv2("cleaned_data/Total_import.csv")

Importations_info <- data.frame(
  col1 = c("Nom", "Number of rows", "Number of columns", "Unit"), 
  col2 = c("Gas Importations", nrow(Importations), ncol(Importations), "Million of cubic meters")
)
names(Importations_info) <- c("", "")

kable(Importations_info)
```

## Electricity generation by source

### For all sources

```{r}

library(readr)

Elec_prod <- read_csv2("cleaned_data/all_sources.csv")

Elec_prod_info <- data.frame(
  col1 = c("Nom", "Number of rows", "Number of columns", "Unit"), 
  col2 = c("Electricity generation by source", nrow(Elec_prod), ncol(Elec_prod), "Gigawatts per hour")
)

names(Elec_prod_info) <- c("", "")

kable(Elec_prod_info)
```

### For one country

```{r}
library(readr)

all_sources <- read_csv("cleaned_data/all_sources.csv")

sources_list <- split(all_sources, all_sources$Country)

France_elec_prod <- sources_list$France

France_elec_prod_info <- data.frame(
  col1 = c("Nom", "Number of rows", "Number of columns", "Unit"), 
  col2 = c("Electricity generation by source for France", nrow(France_elec_prod), ncol(France_elec_prod), "Gigawatts per hour")
)

names(France_elec_prod_info) <- c("", "")

kable(France_elec_prod_info)


```

# Data cleaning description

All data cleaning process can be found here : [Data Cleaning](Datacleaning.qmd)

### Electricity Prices

For the electricity prices, we started with the EnergyPricesNewVersion.csv file containing semi-annual electricity prices for European household consumers.
We loaded the CSV file using the read_csv2 function (adapted for European CSV format with semicolon separators). The original dataset contained metadata in the first rows, so we extracted rows 11 to 22 which contained the actual country data.
We then identified the relevant columns by selecting only those containing semester information (marked with "-S" in the column names using the grepl function). After removing the first row (which contained column headers) and keeping only the Country column and semester columns, we renamed the columns appropriately.
Since the dataset spanned multiple years, we filtered to keep only the periods from 2019 to 2024 using the matches function with a regex pattern.
A major data cleaning challenge was that the original values used European decimal notation (comma as decimal separator) and were expressed in euros per kilowatt-hour. We used gsub to replace commas with periods, converted the strings to numeric values with as.numeric, and multiplied by 1000 to convert the prices from €/kWh to €/MWh (euros per megawatt-hour) for consistency with international standards and easier comparison with gas prices.

### Gas Prices

For the gas prices, we worked with the Dutch TTF Natural Gas Futures Historical Data.csv file, which provides daily TTF (Title Transfer Facility) natural gas prices - the European benchmark for natural gas pricing.
We loaded the CSV using read_csv2 and selected only the first two columns containing the date and price information, renaming them accordingly. The date column required conversion from character format to proper date objects using as.Date with the format "%m/%d/%Y". The price values contained commas as thousand separators (e.g., "1,234.56"), so we used gsub to remove these commas before converting to numeric values.
Since our analysis focuses on the 2019-2024 period to capture the energy crisis, we filtered the data to retain only dates within this range. We then extracted temporal information by creating year, month number, and month name columns using the lubridate functions (year, month) and converting month abbreviations to factors for proper ordering.
To make the data structure compatible with our electricity prices (which are semi-annual), we aggregated the daily gas prices. First, we used pivot_wider to transform the data from long format to a wide format with one column per month and one row per year. Then, we calculated semester averages (S1 for January-June, S2 for July-December) using rowwise and c_across to compute the mean across the relevant months, with na.rm = TRUE to handle any missing values.
Finally, we exported both cleaned datasets to CSV format using write.csv2 (European format with semicolons). We applied rounding to one decimal place using round(., 1) wrapped in mutate(across(...)) to ensure clean, readable values and avoid floating-point precision issues that could create long decimal tails in the exported files.

### Electricity production by source

The original data set provides one data frame by type of fuel. Therefore, we have 8 data frames, each one measuring the production of electricity for the corresponding source in the nine countries.

We loaded each data frame using the read.csv function and suppressed the useless columns (last update, frequency...). Then we renamed the remaining columns into Country, Source, Year and Electricity_prod.

Then, we merged all the data frames in order to get all the sources in on frame using the function bind_rows. The function pivot_wider allows us to have a more lisible frame with a column per source Finally, we created a list by country from the all sources frame using the function split. This make it easier to extract one data frame per country.

### Importations

For the importations, we started by cleaning the 2 initial frames : pipeline and LNG

For the pipeline, we simply loaded the csv, suppressed the irrelevant columns and renamed the remaining ones.

For each LNG data frame (one for each year), we also suppressed the irrelevant columns, renamed the remaining ones and used the pivot_wider function. Then, we merged all the years in one single data frame using the bind_rows function. Since all the values in the data frames where characters, we changed it to numeric (except for the Year column) and replaced the NA by 0 (since it wouldn't change the result of our analysis). The next issue is that the LNG importations where expressed in kilograms, and the pipeline in MCM (million of cubic meters). Therefore, we decided to convert the LNG in MCM by dividing each value by the LNG density \* 1 000 000. 

Another issue was that the LNG importations where collected annually and not monthly. We created a column of the form Year-Month using the str functions. We then divided each value by 12 to have a distribution of the annual quantity imported across the 12 months.

Then, in order to join both data frames, we extracted the keys (Year and Country) from the pipeline importation data frame and added them to the LNG importations thanks to the left_join function. We also used left_join to add the LNG importations to the pipeline importations and get the Total importations data frame. Finally, we created a column thanks to mutate to sum both importations and get the total importations.


# Key Variables

### Electricity Prices: 

Semi-annual household electricity prices (€/MWh) for 9 European countries (Bulgaria, Denmark, Germany, Spain, France, Netherlands, Poland, Finland, Sweden) from 2019-S1 to 2024-S2, excluding taxes and levies. This variable captures the dramatic price increases during the 2022 energy crisis, with prices more than doubling in some countries like the Netherlands (from 136 €/MWh in 2019-S1 to 432 €/MWh in 2023-S1) before gradually declining.

### Gas Prices:

Monthly Dutch TTF (Title Transfer Facility) natural gas futures prices (€/MWh) from January 2019 to December 2024, representing the European benchmark for natural gas pricing. The dataset includes semester aggregates (S1: January-June, S2: July-December) and shows the unprecedented price spike in 2022, with August reaching 240 €/MWh compared to pre-crisis averages of 10-15 €/MWh.

### Gas Importations:

Monthly natural gas imports from Russia by the 9 European countries (Bulgaria, Denmark, Germany, Spain, France, Netherlands, Poland, Finland, Sweden) from January 2019 to December 2024, measured in million cubic meters (MCM). The data distinguishes between pipeline imports and LNG (Liquified Natural Gas) imports, tracking the dramatic shift in European energy supply following reduced Russian gas deliveries after February 2022.

### Electricity Generation by Source:

Monthly electricity production (GWh) for each of the 9 countries from January 2019 to December 2024, decomposed by energy source including combustible fuels, hydro, solar, wind, nuclear, natural gas, and renewables/biofuels. This variable enables analysis of how different countries' energy mixes (e.g., France's nuclear-heavy production vs. Germany's renewable-focused approach) affected their vulnerability to the gas price shock and subsequent electricity price increases.


# Research Question

The 2022 European Energy Crisis represents one of the most significant economic shocks to affect the European Union in recent decades. Triggered by Russia's invasion of Ukraine in February 2022 and the subsequent disruption of natural gas supplies to Europe, this crisis sent energy prices soaring to unprecedented levels, threatening economic stability and household welfare across the continent. Our research seeks to understand the dynamics and heterogeneity of this crisis by examining how electricity and natural gas prices evolved across nine European countries with diverse energy profiles.

**Central Question**: How did electricity and natural gas prices respond to the 2022 energy supply shock across different European countries, and what role did national energy mix compositions play in mediating these price responses?

The choice of our nine countries—France, Germany, Spain, Italy, Netherlands, Poland, Bulgaria, Sweden, and Finland—is deliberate and reflects the diversity of European energy systems. France relies heavily on nuclear power, which theoretically insulates it from natural gas price volatility. Germany, conversely, had become increasingly dependent on Russian gas imports and was forced to rapidly restructure its energy supply. Spain and Italy represent southern European economies with different infrastructure and import dependencies. The Netherlands hosts the TTF gas hub, Europe's primary natural gas trading benchmark. Poland and Bulgaria represent Central and Eastern European economies with historical ties to Russian energy. Finally, Sweden and Finland represent Nordic countries with substantial hydroelectric and renewable capacity.

Our analysis focuses on the period from 2019 to 2024, allowing us to establish pre-crisis baseline trends and observe both the acute crisis phase in 2022-2023 and the subsequent adjustment period. By examining electricity prices alongside natural gas prices, we can investigate the transmission mechanisms through which gas price shocks affected electricity markets.

Several key sub-questions guide our investigation. First, we examine the timing and magnitude of price increases: did all countries experience simultaneous shocks, or were there temporal variations reflecting different supply vulnerabilities? Second, we explore price convergence and divergence: did the crisis lead to greater price harmonization across Europe, or did it exacerbate existing price differentials? Third, we investigate the relationship between gas and electricity prices: how tightly coupled were these markets, and did this coupling vary across countries?

This crisis serves as a natural experiment for understanding how integrated European energy markets function under extreme stress. Also, by examining how different energy mixes performed during the crisis, we can inform debates about optimal transition pathways that balance climate objectives with economic resilience.


# The main observed variable: Electricity prices between 2019 and 2023

Household electricity prices represent our primary outcome variable of interest, as they directly reflect the impact of the 2022 European energy crisis on consumers across nine European countries. This analysis examines how variations in Russian gas import dependence, natural gas price shocks, and national electricity generation mixes (nuclear, renewables, fossil fuels) influenced the magnitude and timing of electricity price increases during the 2022-2024 crisis period

## Graphical representation

```{r}

library(tidyverse)
library(readr)

electricity_prices <- read_csv2("cleaned_data/Energypricescleaned.csv")


elec_long <- electricity_prices %>%
  filter(!is.na(Country), Country != "GEO (Labels)") %>%
  pivot_longer(cols = -Country, names_to = "Period", values_to = "Price") %>%
  filter(!is.na(Price)) %>%
  mutate(Price = as.numeric(Price))

# Calcule la moyenne EU-9
elec_avg <- elec_long %>%
  group_by(Period) %>%
  summarise(Price = mean(Price, na.rm = TRUE)) %>%
  mutate(Country = "EU-9 Average")


elec_all <- bind_rows(elec_long, elec_avg)

# Crée le graphique
ggplot(elec_all, aes(x = Period, y = Price, color = Country, group = Country)) +

  geom_line(data = filter(elec_all, Country != "EU-9 Average"), 
            size = 1, alpha = 0.7) +

  geom_line(data = filter(elec_all, Country == "EU-9 Average"), 
            size = 2, color = "black") +
  
  geom_vline(xintercept = 7, linetype = "dashed", color = "darkred") +
  annotate("text", x = 7, y = 430, 
           label = "Russia invades\nUkraine (Feb 2022)", 
           color = "darkred", size = 3, hjust = -0.1) +
  labs(title = "Electricity Prices by Country (2019-2024)",
       subtitle = "Individual countries (colored) and EU-9 average (black line)",
       x = "Semester", 
       y = "€/MWh") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "right")
```
```

