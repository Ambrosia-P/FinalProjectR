---
title: "DataCleaning"
format: html
editor: visual
---

```{r}

library(readxl)
library(tidyverse)
library(lubridate)
library(dplyr)

# TABLE 1: ELECTRICITY PRICES 

elec_raw <- read_excel("Electricity_Prices.xlsx", sheet = "Data")


electricity_prices <- elec_raw[11:22, ]


col_names <- as.character(electricity_prices[1, ])


period_cols <- which(grepl("-S", col_names))

electricity_prices <- electricity_prices[-1, c(1, period_cols)]

colnames(electricity_prices) <- c("Country", col_names[period_cols])
electricity_prices <- electricity_prices %>% select(Country, matches("2019|2020|2021|2022|2023|2024"))


electricity_prices <- electricity_prices %>%
  mutate(across(-Country, ~as.numeric(.) * 1000))


cat("\n=== ELECTRICITY PRICES ===\n")
print(electricity_prices)


#Table 2: Gas Prices


raw <- read_excel("TTF_Prices.xlsx", skip = 1)


df <- raw %>%
  select(1:2) %>%                    
  rename(date = 1, price = 2) %>%
  mutate(

    date  = as.Date(date, format = "%m/%d/%Y"),
   
    price = as.numeric(gsub(",", "", price))
  )


df_filtered <- df %>%
  filter(date >= as.Date("2019-01-01"),
         date <= as.Date("2024-12-31")) %>%
  mutate(
    year      = year(date),
    month_num = month(date),
    month     = factor(month.abb[month_num], levels = month.abb)
  )


table_year_month <- df_filtered %>%
  select(year, month, month_num, price) %>%
  arrange(year, month_num) %>%
  select(-month_num) %>%
  pivot_wider(
    names_from  = month,
    values_from = price
  ) %>%
  arrange(year)

table_year_month <- table_year_month %>%
  mutate(across(Jan:Dec, as.numeric))


table_year_month_S <- table_year_month %>%
  rowwise() %>%
  mutate(
    S1 = mean(c_across(Jan:Jun), na.rm = TRUE),
    S2 = mean(c_across(Jul:Dec), na.rm = TRUE)
  ) %>%
  ungroup()


table_semesters <- table_year_month_S %>%
  select(year, S1, S2) %>%
  pivot_longer(
    cols      = c(S1, S2),
    names_to  = "semester",
    values_to = "price"
  ) %>%
  arrange(year, semester)


table_year_month_S



```

```{r}

library(writexl)


write_xlsx(
  electricity_prices,
  path = "Energypricescleaned.xlsx"
)

write_xlsx(
  table_year_month_S,
  path = file.path(getwd(), "Gaspricescleaned.xlsx")
)

```







```{r}
Imports_from_russia <- read.csv("imports_from_russia.csv")

Imports_from_russia <- Imports_from_russia[,-c(1,2,3,4,5,6,10,11)]


```

